<script type="text/ng-template" id="categoryTree">
    <div class="treenode" ng-class="{'highlight':obj.id===treeOPT.tmpobj.id, 'background-grey':(obj.type==='company' && obj.id!==treeOPT.tmpobj.id)}">
        <button ng-if="obj.projects.length" class="btn-none" ng-click="treeToggleChildren(obj)">
            <span class="fa" ng-class="{'fa-caret-down':obj.childrenVisible && obj.projects.length,'fa-caret-right':!obj.childrenVisible && obj.projects.length}"></span>
        </button>        
        <a href="javascript:void(0)" ng-click="editTreebranch(obj, 0)">{{ obj.title }}</a>
        <div ng-if="obj.resources && treeOpt.treePeopleView">
            <small class="clearfix" ng-repeat="person in obj.resources">
                {{::person.firstName}} {{::person.lastName}}
                <span ng-if="treeOpt.treeRatesView"> @
                    <select ng-model="person.rate" ng-options="item.id as (item.title + ' ' + item.rate) for item in rates">
                        <option value=''>Select Rate</option>
                    </select>                
                </span>
            </small>
        </div>
    </div>        
    <ul ng-if="obj.projects.length && obj.childrenVisible">
        <li ng-repeat="obj in obj.projects" ng-include="'categoryTree'"></li>
    </ul>
</script>
<div class="row">    
    <div class="col-sm-3">
        <div class="panel panel-white no-border-radius">
            <div class="panel-heading">
            	<h4>Rates</h4>
                <ul class="panel-header-actions border-light"> <!-- RATES Menu -->
                    <li>
                        <div class="dropdown">
                            <button class="btn-none dropdown-toggle"><span class="fa fa-gears fa-2x"></span></button>                       
                            <ul class="dropdown-menu" role="menu">
                                <li>
                                    <a href="javascript:void(0)" ng-click="addRate()"><span class="fa fa-plus"></span> New Rate</a>     
                                </li>
                                <li>
                                    <a href="javascript:void(0)" ng-click="ratesTMP.ratesEdit=!ratesTMP.ratesEdit">
                                        <span class="fa" ng-class="{'fa-pencil-square-o':!ratesTMP.ratesEdit, 'fa-check':ratesTMP.ratesEdit}"></span> 
                                        <span ng-if="!ratesTMP.ratesEdit">Edit Rates</span><span ng-if="ratesTMP.ratesEdit">Done Editing</span>
                                    </a>                                 
                                </li>             
                            </ul>
                        </div>
                    </li> 
                    <li ng-if="ratesTMP.view">
                        <button class="btn-none margin-right-M" ng-click="rateCancel()"><span class="fa fa-times fa-2x"></span></button>
                        <button class="btn-none" ng-disabled="addrateForm.$invalid" ng-click="rateSave()"><span class="fa fa-check fa-2x"></span></button>                       
                    </li>                     
                    <li ng-if="ratesTMP.ratesEdit && !ratesTMP.view">
                        <button class="btn-none" ng-click="rateRestore()"><span class="fa fa-check fa-2x"></span></button>
                    </li> 
                </ul>                    
            </div>
            <div class="panel-body no-padding panel-list-group">        
            	<form name="addrateForm" class="form-spacer">
                    <div class="animate-if padding-M" ng-if="ratesTMP.view">        	                    
                        <input type="text" ng-model="ratesTMP.tmpobj.title" class="form-control" placeholder="Title" required>
                        <select class="form-control" ng-model="ratesTMP.tmpobj.currency" required>
                            <option value="" disabled selected>Currency</option>
                            <option value="CHF">CHF</option>
                            <option value="EUR">EUR</option>
                            <option value="USD">USD</option>
                        </select>
                        <input type="text" ng-model="ratesTMP.tmpobj.rate" class="form-control" name="R_Rate" placeholder="Rate" ng-pattern="/^[+]?\d+([.]\d+)?$/" required>
                        <p class="text-danger" ng-show="addrateForm.R_Rate.$error.pattern">
                            Only numbers allowed
                        </p>
                        <textarea name="R_Description" ng-model="ratesTMP.tmpobj.description" class="form-control" rows="2" placeholder="Description"></textarea>
                    </div>
                </form>
                <div class="list-group">
                    <div class="list-group-item" ng-repeat="rate in ratesTMP.rates">
                        <h4 class="list-group-item-heading">{{rate.title}} <small>{{rate.currency}} {{rate.rate}}</small>
                            <div class="pull-right" ng-if="ratesTMP.ratesEdit">
                                <button class="btn-none" ng-click="rateEdit(rate, $index)">
                                    <span class="fa fa-pencil margin-right-S"></span>                        
                                </button>
                                <button class="btn-none" modal-confirm title="Confirm" text="Delete Rate &quot;{{rate.title}}&quot;?" function="rateDelete(rate.id, $index)">
                                    <span class="fa fa-trash-o"></span>
                                </button>                                
                            </div>
                        </h4>
                    </div>
                </div>                                   
            </div>
        </div>  
    </div>
    <div class="col-sm-9">
        <div class="panel panel-white no-border-radius">
            <div class="panel-heading">
            	<h4>Projects</h4>
                <ul class="panel-header-actions border-light"> <!-- PROJECTS Menu -->
                    <li>
                        <div class="dropdown">
                            <button class="btn-none dropdown-toggle"><span class="fa fa-gears fa-2x"></span></button>
                            <ul class="dropdown-menu" role="menu">
                                <li>
                                    <a href="javascript:void(0)" ng-model="treeOpt.treePeopleView" btn-checkbox btn-checkbox-true="1" btn-checkbox-false="0">
                                        <span class="fa fa-user"></span>
                                        <span ng-if="!treeOpt.treePeopleView">Show Assigned People</span>
                                        <span ng-if="treeOpt.treePeopleView">Hide Assigned People</span>     
                                    </a>
                                </li>
                                <li>
                                    <a href="javascript:void(0)" ng-model="treeOpt.treeRatesView" btn-checkbox btn-checkbox-true="1" btn-checkbox-false="0">
                                        <span class="fa fa-usd"></span>
                                        <span ng-if="!treeOpt.treeRatesView">Show Rates</span>
                                        <span ng-if="treeOpt.treeRatesView">Hide Rates</span>     
                                    </a>                               
                                </li>             
                            </ul>
                        </div>
                    </li> 
                </ul>           
            </div>
            <div class="panel-body">                 
                <div comfort-select model="timeCompany.title" source="treeOPT.companies" source-display="title" function="showTree(item)" title="Company Name" icon="fa-building-o"></div>               
                <div class="tree tree-list pull-left" ng-if="treeOPT.projects">
                    <button type="button" class="tree-close" ng-click="resetTreeView()">&times;</button>
                    <ul>
                        <li>
                            <div class="treenode" ng-class="treeOPT.selectedComp.id===treeOPT.tmpobj.id ? 'highlight':'background-grey'">
                                <a href="javascript:void(0)" ng-click="editTreebranch(treeOPT.selectedComp, 1)">{{treeOPT.selectedComp.title}}</a>
                            </div>
                            <ul ng-if="treeOPT.projects.length">
                                <li ng-repeat="obj in treeOPT.projects track by $index" ng-include="'categoryTree'"></li>
                            </ul>                            
                        </li>
                    </ul>
                </div>                
                <div class="animate-if padding-M margin-left-M pull-left min-width33 border position-relative" ng-if="treeOPT.addeditShow">                    
                    <button type="button" class="tree-close" ng-click="closeEditField()">&times;</button>
                    <tabset>
                        <tab ng-if="!treeOPT.isCompany">                                <!-- EDIT -->
                            <tab-heading><i class="fa fa-pencil"></i></tab-heading>
                            <h4>Edit <small>{{treeOPT.tmpobj.title}}</small></h4>
                            <form name="editTitleForm" class="form-spacer">
                                <input type="text" class="form-control" ng-model="treeOPT.currProj.projectName" placeholder="Name" required>
                                <textarea class="form-control" ng-model="treeOPT.tmpobj.description" placeholder="Description"></textarea>
                            </form>   
                            <button class="btn btn-default pull-right margin-left-S" type="button" ng-click="editProject()" ng-disabled="editTitleForm.$invalid">
                                <span class="fa fa-check"></span>
                            </button>
                            <button class="btn btn-default pull-right" modal-confirm icon="fa-trash-o" title="Confirm" function="deleteSubProjects()"
                            text="Delete Project <strong>{{treeOPT.tmpobj.title}}</strong> with {{treeOPT.tmpobj.projects.length || 'no'}} Sub-Projects?">
                                <span class="fa fa-trash-o"></span>
                            </button>                                                       
                        </tab>
                        <tab>
                            <tab-heading><i class="fa fa-plus"></i></tab-heading>           <!-- ADD -->
                            <h4>Add Project to <small>{{treeOPT.tmpobj.title}}</small></h4>
                            <form name="newChildForm" class="form-spacer">
                                <input type="text" ng-model="treeOPT.newProj.title" class="form-control" placeholder="Project Name" required>
                                <textarea class="form-control" ng-model="treeOPT.newProj.description" placeholder="Description"></textarea>
                                <button class="btn btn-default pull-right" type="button" ng-click="addNewProject()" ng-disabled="newChildForm.$invalid">
                                    <span class="fa fa-check"></span>
                                </button>

                            </form>                            
                        </tab>                        
                        <tab ng-if="!treeOPT.isCompany">                                <!-- People -->
                            <tab-heading><i class="fa fa-user"></i></tab-heading>
                            <h4>Manage Collaborators on <small>{{treeOPT.tmpobj.title}}</small></h4>
                            <div class="form-inline margin-bottom-S">
                                <input type="text" ng-model="treeOPT.peopleselect" placeholder="Person Name" typeahead-on-select="updatePeople($item, treeOPT.tmpobj.people, 'peopleselect')" typeahead="person as (person.firstname + ' ' + person.lastname) for person in people | filter:$viewValue" class="form-control">
                                <div class="btn-group" dropdown>
                                    <button type="button" class="btn btn-default dropdown-toggle">
                                        <span class="fa fa-user"></span> <span class="caret"></span>
                                    </button>
                                    <ul class="dropdown-menu" role="menu">
                                        <li ng-repeat="person in people">
                                            <a ng-click="selectMultiPerson(person, treeOPT.tmpobj.people)" href="javascript:void(0)">{{person.firstname}} {{person.lastname}}</a>
                                        </li>
                                    </ul>
                                </div>                                 
                            </div>
                            <ul class="list-group">
                                <li class="list-group-item" ng-repeat="person in treeOPT.tmpobj.resources">
                                    {{person.firstName}} {{person.lastName}} 
                                    <button type="button" ng-click="removeMultiSinglePerson(person, treeOPT.tmpobj.people)" class="btn-none pull-right">
                                        <span class="fa fa-trash-o"></span>
                                    </button>
                                </li>
                            </ul>                                                
                        </tab>
                    </tabset>                                    
                </div>                 
            </div>
        </div>
    </div>               
</div>  